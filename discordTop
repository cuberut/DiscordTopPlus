// ==UserScript==
// @name         DiscrodTop
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  Wspomaganie g≈Çosowania
// @author       cuberut
// @match        https://docs.google.com/forms/d/e/1FAIpQLSf5XlzMWD_4DtxJ2Ag6pN34ZfoGoKDOpAYVA7Hshjcz4KJhKg/viewform
// @grant        GM_addStyle
// ==/UserScript==

GM_addStyle("div#votedList { position: fixed; margin-left: 650px; width: 300px; padding: 0.75em 1em; overflow: auto; max-height: 95vh; }");
GM_addStyle("div#votedList string { font-size: 14px; }");
GM_addStyle("div#votedList ol { font-size: 12px; padding-left: 1em; margin-top: 1em; }");
GM_addStyle("div#votedList ol li:hover { text-decoration: line-through; cursor: pointer; }");

(function() {
    const forms = document.querySelector("form");
    const loginSection = forms.children[0];
    const songsSection = forms.children[1];

    forms.insertAdjacentHTML('afterbegin', `<div id="votedList" class="geS5n"><strong>Wybrane utwory [<span>0</span>/57]:</strong><ol></ol></div>`);
    const votedCounter = forms.querySelector('#votedList span')
    const votedList = forms.querySelector('#votedList ol')

    var songList = songsSection.querySelectorAll("div[role='checkbox']");

    songsSection.addEventListener("click", (e) => {
        setTimeout(function(){
            const checkedNodes = songsSection.querySelectorAll("div[aria-checked='true']");

            const checkedList = [...checkedNodes].reduce((list, item) => {
                return `${list}<li>${item.ariaLabel}</li>`
            }, "");

            votedCounter.innerText = checkedNodes.length;

            votedList.textContent = null;
            votedList.insertAdjacentHTML('beforeend', checkedList);

            const votedItems = votedList.querySelectorAll('li');

            votedItems.forEach(li => {
                li.addEventListener("click", (e) => {
                    const value = e.target.innerText;
                    const input = songsSection.querySelector(`[aria-label='${value}']`);
                    input.click();
                });
            });
        }, 0);
    });

    setTimeout(function(){
        songsSection.click();
    }, 500);
})();
